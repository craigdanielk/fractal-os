# PHASE 07 — BETA
# STATUS: EMPTY — READY FOR POPULATION
# This phase will be dynamically populated by orchestration.


# PHASE 07 — BETA: FINAL ROUTING + AUTH HARDENING
# STATUS: READY
# EXECUTION MODE: M2M (Cursor Codex)

BEGIN: PHASE_07_BETA

GOAL:
  Ensure cockpit routing, middleware, tenant-auth handshake, and Supabase client
  resolution are fully aligned post‑RLS‑light. Validate no 404s, no infinite loops,
  no duplicated listeners, and no stale references to legacy imports.

TASKS:
  1. Full routing audit across:
       - app/(routes)/**
       - middleware.ts
       - lib/auth/**
       - lib/supabase-client.ts
       - services/*
       - components/Sidebar, Nav, Layout

  2. Patch routing issues:
       - Ensure every route has export const dynamic = 'force-dynamic'
       - Ensure no route imports kernel/*
       - Ensure correct Supabase server vs browser client usage

  3. Middleware hardening:
       - Validate tenant extraction
       - Strip dead branches
       - Ensure no undefined cookies read
       - Ensure middleware always returns a NextResponse

  4. Supabase client reconciliation:
       - browser client only in client components
       - server client only in server components
       - no mixed usage
       - verify correct env usage

  5. Fix all navigation + 404 flows:
       - Verify /dashboard loads
       - Verify /projects, /tasks, /clients loads
       - Ensure tenant selection flows correctly
       - Ensure logged‑out users redirect to /login

  6. Run rebuild:
       - rm -rf .next
       - npm install (if needed)
       - next build

SUCCESS CRITERIA:
  - All cockpit routes resolve without 404
  - Middleware operates without recursion or exceptions
  - No SSR/client mix violations
  - No stale imports
  - next build completes successfully

LOG WHEN COMPLETE:
  Append to /fractal-state/FractalOS_STATE_LOG.md:
    “PHASE_07_BETA — SUCCESS — {timestamp}”
    OR
    “PHASE_07_BETA — BLOCKED — {error_message}”

END: PHASE_07_BETA